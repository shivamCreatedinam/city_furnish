{"version":3,"sources":["index.tsx"],"names":["NativeEventEmitter","NativeModules","Platform","useEffect","useState","LINKING_ERROR","select","ios","default","RNOtpVerify","OtpVerify","Proxy","get","Error","eventEmitter","getOtp","OS","console","warn","startOtpListener","handler","then","addListener","useOtpVerify","numberOfDigits","message","setMessage","otp","setOtp","timeoutError","setTimeoutError","hash","setHash","handleMessage","response","otpDigits","RegExp","exec","getHash","removeListener","startListener","stopListener","requestHint","removeAllListeners"],"mappings":"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","sourcesContent":["import { NativeEventEmitter, NativeModules, Platform } from 'react-native';\nimport { useEffect, useState } from 'react';\n\nconst LINKING_ERROR =\n  `The package 'react-native-otp-verify' doesn't seem to be linked. Make sure: \\n\\n` +\n  Platform.select({ ios: \"- You have run 'pod install'\\n\", default: '' }) +\n  '- You rebuilt the app after installing the package\\n' +\n  '- You are not using Expo managed workflow\\n';\n\nconst RNOtpVerify = NativeModules.OtpVerify\n  ? NativeModules.OtpVerify\n  : new Proxy(\n      {},\n      {\n        get() {\n          throw new Error(LINKING_ERROR);\n        },\n      }\n    );\n\nconst eventEmitter = new NativeEventEmitter(RNOtpVerify);\n\ninterface OtpVerify {\n  getOtp: () => Promise<boolean>;\n  getHash: () => Promise<string[]>;\n  requestHint: () => Promise<string>;\n  startOtpListener: (\n    handler: (value: string) => any\n  ) => Promise<import('react-native').EmitterSubscription>;\n  addListener: (\n    handler: (value: string) => any\n  ) => import('react-native').EmitterSubscription;\n  removeListener: () => void;\n}\n\nexport async function getOtp(): Promise<boolean> {\n  if (Platform.OS === 'ios') {\n    console.warn('Not Supported on iOS');\n    return false;\n  }\n  return RNOtpVerify.getOtp();\n}\n\nexport function startOtpListener(\n  handler: (value: string) => any\n): Promise<import('react-native').EmitterSubscription> {\n  return getOtp().then(() => addListener(handler));\n}\n\nexport const useOtpVerify = ({ numberOfDigits } = { numberOfDigits: 0 }) => {\n  const [message, setMessage] = useState<string | null>(null);\n  const [otp, setOtp] = useState<string | null>(null);\n  const [timeoutError, setTimeoutError] = useState<boolean>(false);\n  const [hash, setHash] = useState<string[] | null>([]);\n\n  const handleMessage = (response: string) => {\n    if (response === 'Timeout Error.') {\n      setTimeoutError(true);\n    } else {\n      setMessage(response);\n      if (numberOfDigits && response) {\n        const otpDigits = new RegExp(`(\\\\d{${numberOfDigits}})`, 'g').exec(response);\n        if (otpDigits && otpDigits[1]) setOtp(otpDigits[1]);\n      }\n    }\n  };\n  useEffect(() => {\n    if (Platform.OS === 'ios') {\n      console.warn('Not Supported on iOS');\n      return;\n    }\n    getHash().then(setHash);\n    startOtpListener(handleMessage);\n    return () => {\n      removeListener();\n    };\n  }, []);\n  const startListener = () => {\n    if (Platform.OS === 'ios') {\n      console.warn('Not Supported on iOS');\n      return;\n    }\n    setOtp('');\n    setMessage('');\n    startOtpListener(handleMessage);\n  };\n  const stopListener = () => {\n    if (Platform.OS === 'ios') {\n      console.warn('Not Supported on iOS');\n      return;\n    }\n    removeListener();\n  };\n  return { otp, message, hash, timeoutError, stopListener, startListener };\n};\n\nexport async function getHash(): Promise<string[]> {\n  if (Platform.OS === 'ios') {\n    console.warn('Not Supported on iOS');\n    return [];\n  }\n  return RNOtpVerify.getHash();\n}\nexport async function requestHint(): Promise<string> {\n  if (Platform.OS === 'ios') {\n    console.warn('Not Supported on iOS');\n    return '';\n  }\n  return RNOtpVerify.requestHint();\n}\n\nexport function addListener(\n  handler: (value: string) => any\n): import('react-native').EmitterSubscription {\n  return eventEmitter.addListener(\n    'com.faizalshap.otpVerify:otpReceived',\n    handler\n  );\n}\n\nexport function removeListener(): void {\n  return eventEmitter.removeAllListeners(\n    'com.faizalshap.otpVerify:otpReceived'\n  );\n}\n\nconst OtpVerify: OtpVerify = {\n  getOtp,\n  getHash,\n  addListener,\n  removeListener,\n  startOtpListener,\n  requestHint,\n};\n\nexport default OtpVerify;\n"]}